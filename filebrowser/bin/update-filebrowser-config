#!/usr/bin/env python3

import argparse
import configparser

cfg_path = "/etc/filebrowser/.filebrowser.yaml"

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("username", help="filebrowser username")
    parser.add_argument("password", help="filebrowser password")
    args = parser.parse_args()

    config = configparser.ConfigParser()
    with open(cfg_path, 'r') as file:
        config.read_file(file)

    config["username"] = args.username

    # call filebrowser hash command to bcrpyt
    import subprocess
    password = args.password
    hash_password = subprocess.run(["filebrowser", "hash", password], capture_output=True, text=True).stdout.strip()
    config["password"] = hash_password
    
    with open(cfg_path, 'w') as file:
        config.write(file)
    print(f"Updated filebrowser configuration")

    # start filebrowser
    subprocess.run(["systemctl", "enable", "--now", "filebrowser.service"])
